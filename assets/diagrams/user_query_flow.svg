<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SEQUENCE" height="919px" preserveAspectRatio="none" style="width:1854px;height:919px;background:#FFFFFF;" version="1.1" viewBox="0 0 1854 919" width="1854px" zoomAndPan="magnify"><title>Flujo Consulta Usuario</title><defs/><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="178.0283" x="839.7046" y="27.9951">Flujo Consulta Usuario</text><rect fill="none" height="148.4688" style="stroke:#000000;stroke-width:1.5;" width="658.5298" x="1106.5757" y="281.2578"/><g><title>User</title><rect fill="#000000" fill-opacity="0.00000" height="719.8594" width="8" x="19.9551" y="118.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="23" x2="23" y1="118.5938" y2="838.4531"/></g><g><title>Client</title><rect fill="#000000" fill-opacity="0.00000" height="719.8594" width="8" x="246.02" y="118.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="249.7549" x2="249.7549" y1="118.5938" y2="838.4531"/></g><g><title>API Gateway</title><rect fill="#000000" fill-opacity="0.00000" height="719.8594" width="8" x="442.1113" y="118.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="445.8896" x2="445.8896" y1="118.5938" y2="838.4531"/></g><g><title>STREAMING Service</title><rect fill="#000000" fill-opacity="0.00000" height="719.8594" width="8" x="638.2026" y="118.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="641.5479" x2="641.5479" y1="118.5938" y2="838.4531"/></g><g><title>CHAT Service</title><rect fill="#000000" fill-opacity="0.00000" height="719.8594" width="8" x="779.1689" y="118.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="782.8574" x2="782.8574" y1="118.5938" y2="838.4531"/></g><g><title>RAG Service</title><rect fill="#000000" fill-opacity="0.00000" height="719.8594" width="8" x="1052.4033" y="118.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1056.231" x2="1056.231" y1="118.5938" y2="838.4531"/></g><g><title>USER Service</title><rect fill="#000000" fill-opacity="0.00000" height="719.8594" width="8" x="1166.5249" y="118.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1169.5757" x2="1169.5757" y1="118.5938" y2="838.4531"/></g><g><title>OLLAMA Service</title><rect fill="#000000" fill-opacity="0.00000" height="719.8594" width="8" x="1294.4961" y="118.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1298.4741" x2="1298.4741" y1="118.5938" y2="838.4531"/></g><g><title>MESSAGE Queue</title><rect fill="#000000" fill-opacity="0.00000" height="719.8594" width="8" x="1519.4287" y="118.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1523.2227" x2="1523.2227" y1="118.5938" y2="838.4531"/></g><g><title>REDIS DB</title><rect fill="#000000" fill-opacity="0.00000" height="719.8594" width="8" x="1635.2368" y="118.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1638.6348" x2="1638.6348" y1="118.5938" y2="838.4531"/></g><g><title>CHAT DB</title><rect fill="#000000" fill-opacity="0.00000" height="719.8594" width="8" x="1716.4722" y="118.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1719.8389" x2="1719.8389" y1="118.5938" y2="838.4531"/></g><g><title>VECTOR DB</title><rect fill="#000000" fill-opacity="0.00000" height="719.8594" width="8" x="1805.2715" y="118.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1809.1055" x2="1809.1055" y1="118.5938" y2="838.4531"/></g><g class="participant participant-head" data-participant="actor"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="31.9102" x="5" y="115.292">User</text><ellipse cx="23.9551" cy="50.7969" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M23.9551,58.7969 L23.9551,85.7969 M10.9551,66.7969 L36.9551,66.7969 M23.9551,85.7969 L10.9551,100.7969 M23.9551,85.7969 L36.9551,100.7969" fill="none" style="stroke:#181818;stroke-width:0.5;"/></g><g class="participant participant-tail" data-participant="actor"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="31.9102" x="5" y="850.4482">User</text><ellipse cx="23.9551" cy="862.25" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M23.9551,870.25 L23.9551,897.25 M10.9551,878.25 L36.9551,878.25 M23.9551,897.25 L10.9551,912.25 M23.9551,897.25 L36.9551,912.25" fill="none" style="stroke:#181818;stroke-width:0.5;"/></g><g class="participant participant-head" data-participant="client"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="54.5303" x="222.7549" y="87.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="40.5303" x="229.7549" y="107.292">Client</text></g><g class="participant participant-tail" data-participant="client"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="54.5303" x="222.7549" y="837.4531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="40.5303" x="229.7549" y="857.4482">Client</text></g><g class="participant participant-head" data-participant="gateway"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="102.4434" x="394.8896" y="87.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="88.4434" x="401.8896" y="107.292">API Gateway</text></g><g class="participant participant-tail" data-participant="gateway"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="102.4434" x="394.8896" y="837.4531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="88.4434" x="401.8896" y="857.4482">API Gateway</text></g><g class="participant participant-head" data-participant="stream"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="153.3096" x="565.5479" y="87.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="139.3096" x="572.5479" y="107.292">STREAMING Service</text></g><g class="participant participant-tail" data-participant="stream"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="153.3096" x="565.5479" y="837.4531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="139.3096" x="572.5479" y="857.4482">STREAMING Service</text></g><g class="participant participant-head" data-participant="chat"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="108.623" x="728.8574" y="87.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="94.623" x="735.8574" y="107.292">CHAT Service</text></g><g class="participant participant-tail" data-participant="chat"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="108.623" x="728.8574" y="837.4531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="94.623" x="735.8574" y="857.4482">CHAT Service</text></g><g class="participant participant-head" data-participant="rag"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="100.3447" x="1006.231" y="87.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="86.3447" x="1013.231" y="107.292">RAG Service</text></g><g class="participant participant-tail" data-participant="rag"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="100.3447" x="1006.231" y="837.4531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="86.3447" x="1013.231" y="857.4482">RAG Service</text></g><g class="participant participant-head" data-participant="user"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="107.8984" x="1116.5757" y="87.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="93.8984" x="1123.5757" y="107.292">USER Service</text></g><g class="participant participant-tail" data-participant="user"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="107.8984" x="1116.5757" y="837.4531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="93.8984" x="1123.5757" y="857.4482">USER Service</text></g><g class="participant participant-head" data-participant="ollama"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="128.0439" x="1234.4741" y="87.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="114.0439" x="1241.4741" y="107.292">OLLAMA Service</text></g><g class="participant participant-tail" data-participant="ollama"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="128.0439" x="1234.4741" y="837.4531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="114.0439" x="1241.4741" y="857.4482">OLLAMA Service</text></g><g class="participant participant-head" data-participant="queue"><path d="M1459.2227,92.2969 L1587.6348,92.2969 C1592.6348,92.2969 1592.6348,105.4453 1592.6348,105.4453 C1592.6348,105.4453 1592.6348,118.5938 1587.6348,118.5938 L1459.2227,118.5938 C1454.2227,118.5938 1454.2227,105.4453 1454.2227,105.4453 C1454.2227,105.4453 1454.2227,92.2969 1459.2227,92.2969" fill="#E2E2F0" style="stroke:#181818;stroke-width:0.5;"/><path d="M1587.6348,92.2969 C1582.6348,92.2969 1582.6348,105.4453 1582.6348,105.4453 C1582.6348,118.5938 1587.6348,118.5938 1587.6348,118.5938" fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="118.4121" x="1459.2227" y="110.292">MESSAGE Queue</text></g><g class="participant participant-tail" data-participant="queue"><path d="M1459.2227,837.4531 L1587.6348,837.4531 C1592.6348,837.4531 1592.6348,850.6016 1592.6348,850.6016 C1592.6348,850.6016 1592.6348,863.75 1587.6348,863.75 L1459.2227,863.75 C1454.2227,863.75 1454.2227,850.6016 1454.2227,850.6016 C1454.2227,850.6016 1454.2227,837.4531 1459.2227,837.4531" fill="#E2E2F0" style="stroke:#181818;stroke-width:0.5;"/><path d="M1587.6348,837.4531 C1582.6348,837.4531 1582.6348,850.6016 1582.6348,850.6016 C1582.6348,863.75 1587.6348,863.75 1587.6348,863.75" fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="118.4121" x="1459.2227" y="855.4482">MESSAGE Queue</text></g><g class="participant participant-head" data-participant="redisDB"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="67.2041" x="1602.6348" y="115.292">REDIS DB</text><path d="M1621.2368,66.2969 C1621.2368,56.2969 1639.2368,56.2969 1639.2368,56.2969 C1639.2368,56.2969 1657.2368,56.2969 1657.2368,66.2969 L1657.2368,92.2969 C1657.2368,102.2969 1639.2368,102.2969 1639.2368,102.2969 C1639.2368,102.2969 1621.2368,102.2969 1621.2368,92.2969 L1621.2368,66.2969" fill="#E2E2F0" style="stroke:#181818;stroke-width:1.5;"/><path d="M1621.2368,66.2969 C1621.2368,76.2969 1639.2368,76.2969 1639.2368,76.2969 C1639.2368,76.2969 1657.2368,76.2969 1657.2368,66.2969" fill="none" style="stroke:#181818;stroke-width:1.5;"/></g><g class="participant participant-tail" data-participant="redisDB"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="67.2041" x="1602.6348" y="850.4482">REDIS DB</text><path d="M1621.2368,863.75 C1621.2368,853.75 1639.2368,853.75 1639.2368,853.75 C1639.2368,853.75 1657.2368,853.75 1657.2368,863.75 L1657.2368,889.75 C1657.2368,899.75 1639.2368,899.75 1639.2368,899.75 C1639.2368,899.75 1621.2368,899.75 1621.2368,889.75 L1621.2368,863.75" fill="#E2E2F0" style="stroke:#181818;stroke-width:1.5;"/><path d="M1621.2368,863.75 C1621.2368,873.75 1639.2368,873.75 1639.2368,873.75 C1639.2368,873.75 1657.2368,873.75 1657.2368,863.75" fill="none" style="stroke:#181818;stroke-width:1.5;"/></g><g class="participant participant-head" data-participant="chatDB"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="63.2666" x="1685.8389" y="115.292">CHAT DB</text><path d="M1702.4722,66.2969 C1702.4722,56.2969 1720.4722,56.2969 1720.4722,56.2969 C1720.4722,56.2969 1738.4722,56.2969 1738.4722,66.2969 L1738.4722,92.2969 C1738.4722,102.2969 1720.4722,102.2969 1720.4722,102.2969 C1720.4722,102.2969 1702.4722,102.2969 1702.4722,92.2969 L1702.4722,66.2969" fill="#E2E2F0" style="stroke:#181818;stroke-width:1.5;"/><path d="M1702.4722,66.2969 C1702.4722,76.2969 1720.4722,76.2969 1720.4722,76.2969 C1720.4722,76.2969 1738.4722,76.2969 1738.4722,66.2969" fill="none" style="stroke:#181818;stroke-width:1.5;"/></g><g class="participant participant-tail" data-participant="chatDB"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="63.2666" x="1685.8389" y="850.4482">CHAT DB</text><path d="M1702.4722,863.75 C1702.4722,853.75 1720.4722,853.75 1720.4722,853.75 C1720.4722,853.75 1738.4722,853.75 1738.4722,863.75 L1738.4722,889.75 C1738.4722,899.75 1720.4722,899.75 1720.4722,899.75 C1720.4722,899.75 1702.4722,899.75 1702.4722,889.75 L1702.4722,863.75" fill="#E2E2F0" style="stroke:#181818;stroke-width:1.5;"/><path d="M1702.4722,863.75 C1702.4722,873.75 1720.4722,873.75 1720.4722,873.75 C1720.4722,873.75 1738.4722,873.75 1738.4722,863.75" fill="none" style="stroke:#181818;stroke-width:1.5;"/></g><g class="participant participant-head" data-participant="vectorDB"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="82.332" x="1765.1055" y="115.292">VECTOR DB</text><path d="M1791.2715,66.2969 C1791.2715,56.2969 1809.2715,56.2969 1809.2715,56.2969 C1809.2715,56.2969 1827.2715,56.2969 1827.2715,66.2969 L1827.2715,92.2969 C1827.2715,102.2969 1809.2715,102.2969 1809.2715,102.2969 C1809.2715,102.2969 1791.2715,102.2969 1791.2715,92.2969 L1791.2715,66.2969" fill="#E2E2F0" style="stroke:#181818;stroke-width:1.5;"/><path d="M1791.2715,66.2969 C1791.2715,76.2969 1809.2715,76.2969 1809.2715,76.2969 C1809.2715,76.2969 1827.2715,76.2969 1827.2715,66.2969" fill="none" style="stroke:#181818;stroke-width:1.5;"/></g><g class="participant participant-tail" data-participant="vectorDB"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="82.332" x="1765.1055" y="850.4482">VECTOR DB</text><path d="M1791.2715,863.75 C1791.2715,853.75 1809.2715,853.75 1809.2715,853.75 C1809.2715,853.75 1827.2715,853.75 1827.2715,863.75 L1827.2715,889.75 C1827.2715,899.75 1809.2715,899.75 1809.2715,899.75 C1809.2715,899.75 1791.2715,899.75 1791.2715,889.75 L1791.2715,863.75" fill="#E2E2F0" style="stroke:#181818;stroke-width:1.5;"/><path d="M1791.2715,863.75 C1791.2715,873.75 1809.2715,873.75 1809.2715,873.75 C1809.2715,873.75 1827.2715,873.75 1827.2715,863.75" fill="none" style="stroke:#181818;stroke-width:1.5;"/></g><g class="message" data-participant-1="actor" data-participant-2="client"><polygon fill="#181818" points="238.02,145.7266,248.02,149.7266,238.02,153.7266,242.02,149.7266" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="23.9551" x2="244.02" y1="149.7266" y2="149.7266"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="121.2656" x="30.9551" y="144.6606">Introduce consulta</text></g><g class="message" data-participant-1="client" data-participant-2="gateway"><polygon fill="#181818" points="434.1113,174.8594,444.1113,178.8594,434.1113,182.8594,438.1113,178.8594" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="250.02" x2="440.1113" y1="178.8594" y2="178.8594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="100.6421" x="257.02" y="173.7935">POST (con JWT)</text></g><g class="message" data-participant-1="gateway" data-participant-2="chat"><polygon fill="#181818" points="771.1689,203.9922,781.1689,207.9922,771.1689,211.9922,775.1689,207.9922" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="446.1113" x2="777.1689" y1="207.9922" y2="207.9922"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="125.855" x="453.1113" y="202.9263">Redirige la petici&#243;n</text></g><g class="message" data-participant-1="chat" data-participant-2="user"><polygon fill="#181818" points="1158.5249,233.125,1168.5249,237.125,1158.5249,241.125,1162.5249,237.125" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="783.1689" x2="1164.5249" y1="237.125" y2="237.125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="103.5938" x="790.1689" y="232.0591">Solicita historial</text></g><g class="message" data-participant-1="user" data-participant-2="redisDB"><polygon fill="#181818" points="1627.2368,262.2578,1637.2368,266.2578,1627.2368,270.2578,1631.2368,266.2578" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="1170.5249" x2="1633.2368" y1="266.2578" y2="266.2578"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="156.3682" x="1177.5249" y="261.1919">Solicita historial (cach&#233;)</text></g><path d="M1106.5757,281.2578 L1171.0186,281.2578 L1171.0186,288.3906 L1161.0186,298.3906 L1106.5757,298.3906 L1106.5757,281.2578" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="148.4688" style="stroke:#000000;stroke-width:1.5;" width="658.5298" x="1106.5757" y="281.2578"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19.4429" x="1121.5757" y="294.3247">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="68.0518" x="1186.0186" y="293.4683">[Cache hit]</text><g class="message" data-participant-1="redisDB" data-participant-2="user"><polygon fill="#181818" points="1181.5249,315.5234,1171.5249,319.5234,1181.5249,323.5234,1177.5249,319.5234" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="1175.5249" x2="1638.2368" y1="319.5234" y2="319.5234"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="133.3262" x="1187.5249" y="314.4575">Devuelve el historial</text></g><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="1106.5757" x2="1765.1055" y1="328.5234" y2="328.5234"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="79.519" x="1111.5757" y="338.7339">[Cache miss]</text><g class="message" data-participant-1="user" data-participant-2="chatDB"><polygon fill="#181818" points="1708.4722,359.4609,1718.4722,363.4609,1708.4722,367.4609,1712.4722,363.4609" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="1170.5249" x2="1714.4722" y1="363.4609" y2="363.4609"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="119.3359" x="1177.5249" y="358.395">Solicita el historial</text></g><g class="message" data-participant-1="chatDB" data-participant-2="user"><polygon fill="#181818" points="1181.5249,388.5938,1171.5249,392.5938,1181.5249,396.5938,1177.5249,392.5938" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="1175.5249" x2="1719.4722" y1="392.5938" y2="392.5938"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="133.3262" x="1187.5249" y="387.5278">Devuelve el historial</text></g><g class="message" data-participant-1="user" data-participant-2="redisDB"><polygon fill="#181818" points="1627.2368,417.7266,1637.2368,421.7266,1627.2368,425.7266,1631.2368,421.7266" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="1170.5249" x2="1633.2368" y1="421.7266" y2="421.7266"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="173.2656" x="1177.5249" y="416.6606">Guarda en cach&#233; (TTL: 1h)</text></g><g class="message" data-participant-1="user" data-participant-2="chat"><polygon fill="#181818" points="794.1689,453.8594,784.1689,457.8594,794.1689,461.8594,790.1689,457.8594" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="788.1689" x2="1169.5249" y1="457.8594" y2="457.8594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="133.3262" x="800.1689" y="452.7935">Devuelve el historial</text></g><g class="message" data-participant-1="chat" data-participant-2="rag"><polygon fill="#181818" points="1044.4033,482.9922,1054.4033,486.9922,1044.4033,490.9922,1048.4033,486.9922" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="783.1689" x2="1050.4033" y1="486.9922" y2="486.9922"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="249.2344" x="790.1689" y="481.9263">Solicita contexto (consulta + historial)</text></g><g class="message" data-participant-1="rag" data-participant-2="vectorDB"><polygon fill="#181818" points="1797.2715,512.125,1807.2715,516.125,1797.2715,520.125,1801.2715,516.125" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="1056.4033" x2="1803.2715" y1="516.125" y2="516.125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="136.2334" x="1063.4033" y="511.0591">B&#250;squeda sem&#225;ntica</text></g><g class="message" data-participant-1="rag" data-participant-2="chat"><polygon fill="#181818" points="794.1689,541.2578,784.1689,545.2578,794.1689,549.2578,790.1689,545.2578" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="788.1689" x2="1055.4033" y1="545.2578" y2="545.2578"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="122.5542" x="800.1689" y="540.1919">Devuelve contexto</text></g><g class="message" data-participant-1="chat" data-participant-2="queue"><polygon fill="#181818" points="1511.4287,570.3906,1521.4287,574.3906,1511.4287,578.3906,1515.4287,574.3906" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="783.1689" x2="1517.4287" y1="574.3906" y2="574.3906"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="182.438" x="790.1689" y="569.3247">Publica tarea de generaci&#243;n</text></g><g class="message" data-participant-1="queue" data-participant-2="ollama"><polygon fill="#181818" points="1309.4961,599.5234,1299.4961,603.5234,1309.4961,607.5234,1305.4961,603.5234" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="1303.4961" x2="1522.4287" y1="603.5234" y2="603.5234"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="99.4487" x="1315.4961" y="598.4575">Consume tarea</text></g><g class="message" data-participant-1="ollama" data-participant-2="ollama"><line style="stroke:#181818;stroke-width:1;" x1="1298.4961" x2="1340.4961" y1="632.6563" y2="632.6563"/><line style="stroke:#181818;stroke-width:1;" x1="1340.4961" x2="1340.4961" y1="632.6563" y2="645.6563"/><line style="stroke:#181818;stroke-width:1;" x1="1299.4961" x2="1340.4961" y1="645.6563" y2="645.6563"/><polygon fill="#181818" points="1309.4961,641.6563,1299.4961,645.6563,1309.4961,649.6563,1305.4961,645.6563" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="210.9326" x="1305.4961" y="627.5903">Genera respuesta (streamizada)</text></g><g class="message" data-participant-1="ollama" data-participant-2="stream"><polygon fill="#181818" points="653.2026,670.7891,643.2026,674.7891,653.2026,678.7891,649.2026,674.7891" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="647.2026" x2="1297.4961" y1="674.7891" y2="674.7891"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="225.8813" x="659.2026" y="669.7231">Env&#237;a chunks (v&#237;a WebSocket/SSE)</text></g><g class="message" data-participant-1="stream" data-participant-2="gateway"><polygon fill="#181818" points="457.1113,699.9219,447.1113,703.9219,457.1113,707.9219,453.1113,703.9219" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="451.1113" x2="641.2026" y1="703.9219" y2="703.9219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="172.0913" x="463.1113" y="698.856">Streaming de la respuesta</text></g><g class="message" data-participant-1="gateway" data-participant-2="client"><polygon fill="#181818" points="261.02,729.0547,251.02,733.0547,261.02,737.0547,257.02,733.0547" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="255.02" x2="445.1113" y1="733.0547" y2="733.0547"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="172.0913" x="267.02" y="727.9888">Streaming de la respuesta</text></g><g class="message" data-participant-1="client" data-participant-2="actor"><polygon fill="#181818" points="34.9551,758.1875,24.9551,762.1875,34.9551,766.1875,30.9551,762.1875" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="28.9551" x2="249.02" y1="762.1875" y2="762.1875"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="202.0649" x="40.9551" y="757.1216">Muestra chunks en tiempo real</text></g><g class="message" data-participant-1="chat" data-participant-2="chatDB"><polygon fill="#181818" points="1708.4722,787.3203,1718.4722,791.3203,1708.4722,795.3203,1712.4722,791.3203" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="783.1689" x2="1714.4722" y1="791.3203" y2="791.3203"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="256.3628" x="790.1689" y="786.2544">Almacena mensaje y respuesta (async)</text></g><g class="message" data-participant-1="chat" data-participant-2="redisDB"><polygon fill="#181818" points="1627.2368,816.4531,1637.2368,820.4531,1627.2368,824.4531,1631.2368,820.4531" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="783.1689" x2="1633.2368" y1="820.4531" y2="820.4531"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="230.7944" x="790.1689" y="815.3872">Actualiza historial en cach&#233; (async)</text></g><!--SRC=[VLHDSzCm4BthL-pq50-JqfRoCJvaS9Cqj2Iqn6vxtZfBebQMWoK5oh_Xo84JDwxvOwmjkx4PoY4JQz_R3-s-bPLM4PmgTvV3CDV6AOjmPHmMCXS2KviNVAG2q41r4ciih4pb6hM5ePB4VuobrPVee7lHvHbCqD8NVDWhIKl_tIN5oNmSpSu-J22cOYDJggZ65eHPbpby5oKTKhf2swNCeswO0fTTmbKyddSOZY_NfLnCfz4iwf1ofJ138JuxSWHxit4SHvCnV2oF5Q42X5YWnLiqJ9cFHsSnZ4vy5RIGPdJIWgkhr6XvYmvuFHuc5_C6tb3PTYRKu-WFVAz3EDEso1Sk9KZhoGaFzGTrfqEul8WJw34EvpT986exn-2a8Sovi48k2HJ2cieMR7zf8KgmFoWx4qASApQpA5RIS7Q9IfH0Vr1VwbyCJeZfQliZ4AXO9FnD35e1JIUQu2FQE58R0bAj-AIu2zuhayQmcy_e6zLAsF62kf7_Zzt4Ugn-mb9VS2WDlcRe9SaqXCDL84Wln2xpKn7hRh7IMfLnmorzjNdLUhzKptO-WM1sVz1CDeIJxM_34k8w36NRxvedWPxpL-OcRfErqXrFsTroOWIBl3Mm85YIfWBzE2jEV-0r7FejpyXpXRVkq4dbo7CoQqU6o-xvJPJVS861UEHxQmXZlTd-vFkkdButqAiEDtGRv-azsUTnF0w4fxOq6Vk8UbbMgbh9MlAi9VuqjL5wjHCXp4fhyLW8ZzDAojOvU-ncr0WeKXccf14oqWRl21xQ5qRpeDEW6MkZaoYr3XMteINpbcXg9_6MHGCkuvINYb-JgzcK5xWmaXVmSF_euEZb_ejUx7WR-NTm20T7uSlNuT4np4O9b70WUfFBAPZS5RpNdDiMyjPPzW_4EMuGvexLaV7CBzQapqVl6qCv2LdaEYkVuVFhsOxmwhX_8ctrdl4xVZqJ8_g4B4dsIFC5zpQ4g-Iq_qPCKIyTBZasQJ7CEMx1qz9EgJy0]--></g></svg>